<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vua Ti·∫øng Vi·ªát - V4 Speed Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Be+Vietnam+Pro:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #D00000;
            --dark-red: #8B0000;
            --gold: #FFD700;
            --yellow: #FFEB3B;
            --cream: #FFF8E1;
            --blue-team: #2196F3;
            --red-team: #F44336;
            --green-btn: #4CAF50;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }

        body {
            margin: 0; padding: 0; height: 100vh;
            font-family: 'Be Vietnam Pro', sans-serif;
            background: radial-gradient(circle at center, var(--red) 0%, var(--dark-red) 100%);
            color: var(--cream);
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- M√ÄN H√åNH CHUNG --- */
        .screen {
            display: none; width: 100%; height: 100%;
            flex-direction: column; align-items: center; justify-content: center;
            position: absolute; top: 0; left: 0;
            padding: 10px;
            transition: opacity 0.5s;
        }
        .screen.active { display: flex; z-index: 10; }

        h1 {
            font-family: 'Anton', sans-serif;
            color: var(--gold);
            font-size: clamp(2rem, 5vw, 4rem);
            text-transform: uppercase;
            text-shadow: 4px 4px 0 #000;
            margin-bottom: 20px; text-align: center;
        }

        /* --- N√öT B·∫§M --- */
        button {
            background: linear-gradient(180deg, var(--gold), #FFA000);
            border: 2px solid #fff;
            border-radius: 50px;
            padding: 12px 30px;
            color: #b71c1c;
            font-size: 1.1rem; font-weight: 900;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            margin: 5px;
            text-transform: uppercase;
        }
        button:active { transform: scale(0.95); }
        button.secondary { background: rgba(255,255,255,0.2); color: #fff; border: 1px solid rgba(255,255,255,0.5); }
        
        /* N√∫t Ch·ªët ƒê√°p √Ån (M√†u Xanh) */
        button.action-btn {
            background: linear-gradient(180deg, #66BB6A, #2E7D32);
            color: white; border-color: #A5D6A7;
            font-size: 1.3rem; padding: 15px 40px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- SETTINGS SCREEN --- */
        .settings-panel {
            background: rgba(0,0,0,0.6);
            padding: 20px; border-radius: 20px;
            width: 95%; max-width: 600px;
            max-height: 85vh; overflow-y: auto;
            border: 2px solid var(--gold);
        }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; font-weight: bold; margin-bottom: 5px; color: var(--gold); }
        input[type="text"], input[type="number"], textarea, input[type="file"] {
            width: 100%; padding: 10px; border-radius: 8px; border: none;
            font-family: inherit; font-size: 1rem;
        }
        textarea { height: 100px; resize: vertical; }
        .row { display: flex; gap: 10px; align-items: center; }
        .note { font-size: 0.8rem; color: #ccc; font-style: italic; margin-top: 5px; }

        /* --- GAMEPLAY SCREEN --- */
        .top-bar {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100;
        }
        
        .timer-container { position: relative; width: 100%; text-align: center; margin-top: 30px;}
        .timer-text {
            font-family: 'Anton'; font-size: clamp(4rem, 10vw, 6rem); color: #fff;
            text-shadow: 0 0 20px var(--red); line-height: 1;
        }
        
        .word-display {
            font-size: clamp(2rem, 7vw, 4.5rem);
            font-weight: 900;
            color: var(--gold);
            text-shadow: 3px 3px 0 #8B0000, -1px -1px 0 #fff;
            letter-spacing: 3px;
            text-align: center;
            line-height: 1.3;
            background: rgba(0,0,0,0.3);
            padding: 15px; border-radius: 20px;
            border: 2px dashed rgba(255,215,0,0.3);
            width: 95%; max-width: 900px;
            margin: 10px 0;
            text-transform: none !important; /* QUAN TR·ªåNG: Gi·ªØ nguy√™n ch·ªØ th∆∞·ªùng/hoa */
        }

        /* HINT BOX */
        .hint-box {
            min-height: 30px;
            font-size: 1.2rem; color: var(--yellow);
            font-weight: bold; text-align: center;
            text-shadow: 1px 1px 0 #000;
            margin-bottom: 5px;
            opacity: 0; transition: opacity 0.5s;
        }
        .hint-box.show { opacity: 1; animation: popIn 0.5s; }
        
        .action-area {
            width: 100%; display: flex; justify-content: center;
            margin-bottom: 10px; min-height: 60px;
        }

        .result-area {
            display: none; flex-direction: column; align-items: center;
            animation: popIn 0.3s; width: 100%;
        }
        .correct-answer {
            font-size: clamp(1.5rem, 5vw, 2.5rem); color: #2e7d32;
            background: #fff; padding: 10px 30px;
            border-radius: 15px; margin-bottom: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center; font-weight: 900;
            width: 90%; max-width: 600px;
            text-transform: none; /* Gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng ch·ªØ */
        }

        /* --- SCOREBOARD --- */
        .scoreboard {
            display: flex; gap: 20px; width: 95%; max-width: 600px;
            justify-content: center; margin-top: auto; margin-bottom: 10px;
        }
        .team-card {
            flex: 1; background: rgba(0,0,0,0.5);
            border-radius: 15px; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .team-name { font-size: 1rem; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
        .team-score { font-family: 'Anton'; font-size: 2.5rem; line-height: 1; margin-bottom: 5px; }
        .btn-point {
            width: 100%; padding: 8px; margin: 0; font-size: 1rem;
            border-radius: 10px; border: none; color: white;
        }
        .team-blue .team-name { color: var(--blue-team); }
        .team-blue .btn-point { background: var(--blue-team); box-shadow: 0 4px 0 #1565C0; }
        .team-blue .btn-point:active { transform: translateY(4px); box-shadow: none; }
        
        .team-red .team-name { color: var(--red-team); }
        .team-red .btn-point { background: var(--red-team); box-shadow: 0 4px 0 #C62828; }
        .team-red .btn-point:active { transform: translateY(4px); box-shadow: none; }

        /* --- POPUP LEVEL --- */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .popup-content { text-align: center; animation: zoomIn 0.5s; }
        .level-title { font-size: 2rem; color: #aaa; margin-bottom: 10px; }
        .level-number { font-size: 8rem; font-family: 'Anton'; color: var(--gold); margin: 0; line-height: 1; }
        
        /* Animations */
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes zoomIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes pulseRed { 0% { transform: scale(1); color: #fff; } 50% { transform: scale(1.2); color: #ff0000; } 100% { transform: scale(1); color: #fff; } }
        
        .urgent { animation: pulseRed 0.5s infinite; }

        /* Audio Controls */
        .audio-controls {
            display: flex; gap: 10px; align-items: center;
            background: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px;
        }
        input[type=range] { width: 80px; }

    </style>
</head>
<body>

    <div id="screen-setup" class="screen active">
        <h1>VUA TI·∫æNG VI·ªÜT</h1>
        <div class="settings-panel">
            
            <div class="control-group">
                <label>‚è±Ô∏è TƒÉng th√™m th·ªùi gian (Gi√¢y):</label>
                <input type="number" id="time-offset" style="text-align: center; font-weight: bold; background: #fff3cd; color: #856404;" value="0">
            </div>

            <div class="control-group">
                <label>üéµ Nh·∫°c n·ªÅn (MP3/Online):</label>
                <input type="file" id="bg-music-file" accept="audio/*, .mp3">
                <div style="text-align: center; margin: 5px 0; font-size: 0.8rem;">HO·∫∂C D√°n Link Online</div>
                <input type="text" id="bg-music-url" placeholder="https://example.com/music.mp3">
            </div>

            <div class="control-group">
                <label>üìù N·ªôi dung th√™m:</label>
                <div class="note">C√∫ ph√°p: T·ª´ kh√≥a - S·ªë gi√¢y - G·ª£i √Ω (n·∫øu c√≥)</div>
                <textarea id="custom-words" placeholder="V√≠ d·ª•:
B√°nh Ch∆∞ng - 10 - M√≥n ƒÉn h√¨nh vu√¥ng
C√¢y Mai - 10 - Hoa ng√†y T·∫øt mi·ªÅn Nam"></textarea>
            </div>

            <div class="control-group row">
                <input type="checkbox" id="use-default" checked style="width: 20px; height: 20px;">
                <label for="use-default" style="margin:0; cursor:pointer;">S·ª≠ d·ª•ng b·ªô t·ª´ m·∫∑c ƒë·ªãnh?</label>
            </div>

            <button onclick="initGame()" style="width: 100%">B·∫ÆT ƒê·∫¶U TR√í CH∆†I</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="top-bar">
            <div class="audio-controls">
                <span id="music-icon">üîä</span>
                <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
            </div>
            <button class="secondary" onclick="toggleFullScreen()">‚õ∂ Full</button>
        </div>

        <h2 style="color: rgba(255,255,255,0.5); margin-top: 10px; margin-bottom: 0;" id="q-counter">C√¢u 1</h2>
        
        <div class="timer-container">
            <div class="timer-text" id="timer-display">10</div>
        </div>
        
        <div class="word-display" id="word-display">...</div>
        
        <div class="hint-box" id="hint-box"></div>

        <div class="action-area">
            <button id="btn-stop" class="action-btn" onclick="endLevel()">‚úÖ CH·ªêT ƒê√ÅP √ÅN NGAY</button>
            
            <div class="result-area" id="result-area">
                <div class="correct-answer" id="correct-answer">ƒê√ÅP √ÅN</div>
                <button onclick="nextQuestion()">C√ÇU TI·∫æP THEO ‚ûú</button>
            </div>
        </div>

        <div class="scoreboard">
            <div class="team-card team-blue">
                <div class="team-name">ƒê·ªòI XANH</div>
                <div class="team-score" id="score-1">0</div>
                <button class="btn-point" onclick="addScore(1)">+1 ƒêI·ªÇM</button>
            </div>
            <div class="team-card team-red">
                <div class="team-name">ƒê·ªòI ƒê·ªé</div>
                <div class="team-score" id="score-2">0</div>
                <button class="btn-point" onclick="addScore(2)">+1 ƒêI·ªÇM</button>
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popup-overlay" onclick="startLevelTimer()">
        <div class="popup-content">
            <div class="level-title">C√ÇU H·ªéI S·ªê</div>
            <div class="level-number" id="popup-num">1</div>
            <div style="margin-top: 20px; font-size: 1.2rem; color: #fff;">S·∫µn s√†ng ch∆∞a?</div>
            <div style="margin-top: 30px; font-size: 0.9rem; color: var(--yellow); opacity: 0.7;">(Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ b·∫Øt ƒë·∫ßu)</div>
        </div>
    </div>

    <audio id="bg-audio" loop></audio>
    
    <script>
        // --- DATA ---
        const defaultData = [
            { a: "Th√°i ƒê·ªô", t: 7, h: "C√°ch c∆∞ x·ª≠" },
            { a: "Ki·ªÉm So√°t", t: 15, h: "N·∫Øm quy·ªÅn ƒëi·ªÅu h√†nh" },
            { a: "Khai M·∫°c", t: 10, h: "B·∫Øt ƒë·∫ßu s·ª± ki·ªán" },
            { a: "Thanh to√°n", t: 10, h: "Tr·∫£ ti·ªÅn" },
            { a: "√Çm Nh·∫°c", t: 7, h: "Giai ƒëi·ªáu cu·ªôc s·ªëng" },
            { a: "Ph√†n n√†n", t: 10, h: "K√™u ca, kh√¥ng h√†i l√≤ng" },
            { a: "Gi√°o vi√™n", t: 10, h: "Ng∆∞·ªùi ƒë·ª©ng tr√™n b·ª•c gi·∫£ng" },
            { a: "Vi·ªác L√†m", t: 7, h: "Ngh·ªÅ nghi·ªáp" },
            { a: "X√¢y d·ª±ng", t: 10, h: "Ki·∫øn thi·∫øt c√¥ng tr√¨nh" },
            { a: "Nh·ªôn Nh·ªãp", t: 7, h: "ƒê√¥ng vui, t·∫•p n·∫≠p" },
            { a: "B·ªÅ Th·∫ø", t: 7, h: "To l·ªõn, sang tr·ªçng" },
            { a: "B·∫£n ƒë·ªãa", t: 7, h: "Ng∆∞·ªùi g·ªëc ·ªü v√πng ƒë√≥" },
            { a: "im l√¨m", t: 7, h: "Kh√¥ng m·ªôt ti·∫øng ƒë·ªông" }, // Vi·∫øt th∆∞·ªùng ho√†n to√†n
            { a: "Kh√°m x√©t", t: 10, h: "Ki·ªÉm tra k·ªπ l∆∞·ª°ng" },
            { a: "T√†i s·∫£n", t: 7, h: "C·ªßa c·∫£i v·∫≠t ch·∫•t" },
            // Extra words
            { a: "Vi·ªát Nam V√¥ ƒê·ªãch", t: 15, h: "C√¢u h√¥ h√†o b√≥ng ƒë√°" },
            { a: "X√≥m 54/92", t: 7, h: "ƒê·ªãa ch·ªâ th√¢n th∆∞∆°ng" },
            { a: "√çt Nh·∫≠u Th√¥i", t: 12, h: "L·ªùi khuy√™n s·ª©c kh·ªèe" },
            { a: "ƒê√°nh Pickleball", t: 12, h: "M√¥n th·ªÉ thao ƒëang hot" },
            { a: "X√≥m vƒÉn minh", t: 15, h: "Khu d√¢n c∆∞ g∆∞∆°ng m·∫´u" },
            { a: "T·∫øt May M·∫Øn", t: 15, h: "L·ªùi ch√∫c ƒë·∫ßu nƒÉm" },
            { a: "T√¨nh L√†ng Nghƒ©a X√≥m", t: 25, h: "M·ªëi quan h·ªá l√°ng gi·ªÅng" },
            { a: "Gia ƒê√¨nh", t: 7, h: "T·ªï ·∫•m" },
            { a: "H·∫°nh Ph√∫c", t: 7, h: "ƒêi·ªÅu ai c≈©ng mong mu·ªën" },
            { a: "Ph√°t T√†i", t: 7, h: "Gi√†u c√≥" },
            { a: "NƒÉm M·ªõi", t: 7, h: "Th·ªùi kh·∫Øc giao th·ª´a" },
            { a: "M·∫°nh Kho·∫ª", t: 10, h: "Kh√¥ng ·ªëm ƒëau" },
            // New words requested
            { a: "Qu√† T·∫øt", t: 7, h: "Bi·∫øu t·∫∑ng d·ªãp xu√¢n" },
            { a: "L√¨ x√¨", t: 5, h: "Ti·ªÅn m·ª´ng tu·ªïi" },
            { a: "M√°u l√™n anh em ∆°i", t: 15, h: "C√¢u h√¥ h√†o s√¥i ƒë·ªông" }
        ];

        let gameData = [];
        let currentIndex = 0;
        let timerInterval;
        let timeLeft = 0;
        let audioCtx;
        let scores = [0, 0]; // Team 1, Team 2

        // --- UTILS ---
        function scrambleWord(word) {
            let chars = word.replace(/\s+/g, '').split('');
            for (let i = chars.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [chars[i], chars[j]] = [chars[j], chars[i]];
            }
            // Kh√¥ng lowercase to√†n b·ªô n·ªØa ƒë·ªÉ gi·ªØ nguy√™n ch·ªØ I hoa n·∫øu c√≥ (t√πy √Ω)
            // Nh∆∞ng v·ªõi y√™u c·∫ßu im l√¨m, ta ƒë√£ ch·ªânh data ƒë·∫ßu v√†o.
            return chars.join('/').toLowerCase(); 
        }

        function createTickSound() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.value = 800;
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1);
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- GAME LOGIC ---
        function initGame() {
            gameData = [];
            const useDefault = document.getElementById('use-default').checked;
            const timeOffset = parseInt(document.getElementById('time-offset').value) || 0;

            // Process default data
            if (useDefault) {
                defaultData.forEach(item => {
                    gameData.push({
                        a: item.a,
                        s: scrambleWord(item.a),
                        t: Math.max(5, item.t + timeOffset),
                        h: item.h || "S·∫Øp h·∫øt gi·ªù r·ªìi!"
                    });
                });
            }

            // Process custom input
            const customText = document.getElementById('custom-words').value.trim();
            if (customText) {
                const lines = customText.split('\n');
                lines.forEach(line => {
                    const parts = line.split('-').map(p => p.trim());
                    if (parts.length >= 1 && parts[0]) {
                        const word = parts[0];
                        let time = parts[1] ? parseInt(parts[1]) : 10;
                        let hint = parts[2] || "C·ªë l√™n n√†o!";
                        
                        time = Math.max(5, time + timeOffset);

                        gameData.push({
                            a: word,
                            s: scrambleWord(word),
                            t: time,
                            h: hint
                        });
                    }
                });
            }

            if (gameData.length === 0) {
                alert("Vui l√≤ng ch·ªçn d·ªØ li·ªáu!");
                return;
            }

            gameData.sort(() => Math.random() - 0.5);

            // Audio Setup
            const fileInput = document.getElementById('bg-music-file');
            const urlInput = document.getElementById('bg-music-url');
            const audioEl = document.getElementById('bg-audio');

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                audioEl.src = URL.createObjectURL(file);
            } else if (urlInput.value) {
                audioEl.src = urlInput.value;
            } else {
                audioEl.src = "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"; 
            }
            audioEl.volume = 0.5;

            // Switch Screen
            document.getElementById('screen-setup').classList.remove('active');
            document.getElementById('screen-game').classList.add('active');
            
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            currentIndex = 0;
            showPopup();
        }

        function showPopup() {
            const popup = document.getElementById('popup-overlay');
            document.getElementById('popup-num').innerText = currentIndex + 1;
            popup.style.display = 'flex';
            
            const bgAudio = document.getElementById('bg-audio');
            if (bgAudio.paused && bgAudio.src) {
                bgAudio.play().catch(e => console.log("Audio waiting for interaction"));
            }
        }

        function startLevelTimer() {
            document.getElementById('popup-overlay').style.display = 'none';
            
            const currentItem = gameData[currentIndex];
            document.getElementById('q-counter').innerText = `C√¢u h·ªèi ${currentIndex + 1} / ${gameData.length}`;
            document.getElementById('word-display').innerText = currentItem.s;
            document.getElementById('correct-answer').innerText = currentItem.a;
            
            // Reset UI for new round
            document.getElementById('result-area').style.display = 'none';
            document.getElementById('btn-stop').style.display = 'block'; // Hi·ªÉn th·ªã l·∫°i n√∫t Ch·ªët
            
            const hintBox = document.getElementById('hint-box');
            hintBox.innerText = "";
            hintBox.classList.remove('show');
            
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.classList.remove('urgent');
            timerDisplay.style.color = "#fff";

            // Timer Logic
            timeLeft = currentItem.t;
            timerDisplay.innerText = timeLeft;
            
            const hintTriggerTime = currentItem.t <= 10 ? 3 : 5;
            let hintShown = false;

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = timeLeft;

                if (timeLeft <= hintTriggerTime && !hintShown) {
                    hintBox.innerText = "G·ª¢I √ù: " + currentItem.h;
                    hintBox.classList.add('show');
                    hintShown = true;
                }

                if (timeLeft <= 3 && timeLeft > 0) {
                    timerDisplay.classList.add('urgent');
                    timerDisplay.style.color = "var(--red)";
                    createTickSound();
                }

                if (timeLeft <= 0) {
                    endLevel();
                }
            }, 1000);
        }

        function endLevel() {
            clearInterval(timerInterval);
            // Hide Stop Button
            document.getElementById('btn-stop').style.display = 'none';
            
            const timerDisplay = document.getElementById('timer-display');
            // N·∫øu h·∫øt gi·ªù th√¨ hi·ªán H·∫æT GI·ªú, n·∫øu b·∫•m ch·ªët s·ªõm th√¨ gi·ªØ nguy√™n s·ªë gi√¢y c√≤n l·∫°i (ho·∫∑c hi·ªán STOP)
            if(timeLeft <= 0) {
                timerDisplay.innerText = "H·∫æT GI·ªú!";
            } else {
                // Gi·ªØ nguy√™n s·ªë gi√¢y ƒë·ªÉ bi·∫øt tr·∫£ l·ªùi nhanh bao nhi√™u
            }
            
            timerDisplay.classList.remove('urgent');
            document.getElementById('result-area').style.display = 'flex';
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < gameData.length) {
                showPopup();
            } else {
                alert("Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√¢u h·ªèi.");
                location.reload();
            }
        }

        // --- SCORING ---
        function addScore(team) {
            if (team === 1) {
                scores[0]++;
                document.getElementById('score-1').innerText = scores[0];
            } else {
                scores[1]++;
                document.getElementById('score-2').innerText = scores[1];
            }
        }

        // --- CONTROLS ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Hotkey Space ƒë·ªÉ ch·ªët ƒë√°p √°n
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                // Ch·ªâ k√≠ch ho·∫°t khi m√†n h√¨nh game ƒëang active v√† ch∆∞a hi·ªán k·∫øt qu·∫£
                if (document.getElementById('screen-game').classList.contains('active') &&
                    document.getElementById('result-area').style.display === 'none' && 
                    document.getElementById('popup-overlay').style.display === 'none') {
                    endLevel();
                }
            }
        });

        document.getElementById('volume-slider').addEventListener('input', function(e) {
            const audio = document.getElementById('bg-audio');
            audio.volume = e.target.value;
            if(e.target.value == 0) document.getElementById('music-icon').innerText = 'üîá';
            else document.getElementById('music-icon').innerText = 'üîä';
        });

    </script>
</body>
</html>
